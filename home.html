<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guida TV Sport – Homepage personale</title>
  <style>
    :root { --bg: #0b0c0f; --fg: #e7e9ea; --muted:#a3a3a3; --card:#14171a; --accent:#4f46e5; }
    [data-theme="light"] { --bg:#f7f7f8; --fg:#0b0c0f; --muted:#4b5563; --card:#ffffff; --accent:#2563eb; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--fg); font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; height:100vh; display:flex; flex-direction:column; }
    header { padding: 12px 16px; background: var(--card); border-bottom: 1px solid #1f2937; display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    h1 { font-size:16px; margin:0 8px 0 0; white-space:nowrap; }
    .spacer { flex:1 1 auto; }
    .btn { border:1px solid #374151; background:transparent; color:var(--fg); padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn:hover { border-color:#4b5563; }
    .btn.primary { background: var(--accent); border-color: var(--accent); color:#fff; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    input[type="date"] { background:var(--card); color:var(--fg); border:1px solid #374151; padding:7px 8px; border-radius:10px; }
    label { color: var(--muted); }
    .container { flex:1 1 auto; display:grid; grid-template-columns: 1fr; grid-auto-rows:1fr; }
    iframe { width:100%; height: calc(100vh - 72px); border:0; background:#fff; }
    footer { padding:8px 16px; color:var(--muted); font-size:12px; background:var(--card); border-top:1px solid #1f2937; }
    .toggle { display:flex; align-items:center; gap:6px; }
    .link { color:#93c5fd; text-decoration:none; }
    .link:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <header>
    <h1>Guida TV Sport</h1>
    <div class="row">
      <button class="btn" id="prevBtn" title="Giorno precedente">◀︎</button>
      <input type="date" id="datePick" />
      <button class="btn" id="todayBtn" title="Oggi (Europa/Roma)">Oggi</button>
      <button class="btn" id="nextBtn" title="Giorno successivo">▶︎</button>
      <button class="btn" id="openSrc">Apri pagina sorgente</button>
      <button class="btn primary" id="openStandalone">Apri pagina completa</button>
    </div>
    <div class="spacer"></div>
    <div class="row">
      <label class="toggle"><input type="checkbox" id="tomorrowToggle" /> Mostra anche Domani</label>
      <label class="toggle"><input type="checkbox" id="themeToggle" /> Tema chiaro</label>
    </div>
  </header>

  <div class="container" id="frames">
    <iframe id="frameToday" referrerpolicy="no-referrer" loading="eager"></iframe>
    <iframe id="frameTomorrow" referrerpolicy="no-referrer" loading="eager" style="display:none"></iframe>
  </div>

  <footer>
    Fonte: <a class="link" href="https://sport.virgilio.it/guida-tv/" target="_blank" rel="noopener">Virgilio Sport – Guida TV</a> · Mirror tabelle: <a class="link" id="mirrorLink" href="#" target="_blank" rel="noopener">GitHub Pages</a>
  </footer>

  <script>
    // ====== CONFIG ======
    const BASE = "https://jusseppe88.github.io/virgilio-sport-rss/index.html"; // your mirrored tables page
    const TZ = "Europe/Rome";

    // ====== Helpers ======
    function fmtDateYMD(d){ // returns YYYY-MM-DD in Europe/Rome
      const s = new Intl.DateTimeFormat('en-CA', { timeZone: TZ, year:'numeric', month:'2-digit', day:'2-digit' }).format(d);
      return s; // en-CA → 2025-10-30
    }
    function parseYMD(s){ const [y,m,d]=s.split('-').map(Number); return new Date(Date.UTC(y,m-1,d)); }
    function addDays(ymd, n){ const d=parseYMD(ymd); d.setUTCDate(d.getUTCDate()+n); return fmtDateYMD(d); }
    function anchorFor(ymd){ return `${BASE}#${ymd}`; }

    // ====== State ======
    const frameToday = document.getElementById('frameToday');
    const frameTomorrow = document.getElementById('frameTomorrow');
    const datePick = document.getElementById('datePick');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const todayBtn = document.getElementById('todayBtn');
    const openSrc = document.getElementById('openSrc');
    const openStandalone = document.getElementById('openStandalone');
    const tomorrowToggle = document.getElementById('tomorrowToggle');
    const themeToggle = document.getElementById('themeToggle');
    const mirrorLink = document.getElementById('mirrorLink');

    // Theme
    const savedTheme = localStorage.getItem('sportsHomeTheme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.checked = savedTheme === 'light';
    themeToggle.addEventListener('change', () => {
      const theme = themeToggle.checked ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('sportsHomeTheme', theme);
    });

    function setDate(ymd){
      datePick.value = ymd;
      frameToday.src = anchorFor(ymd);
      mirrorLink.href = anchorFor(ymd);
      if(tomorrowToggle.checked){
        const tm = addDays(ymd, 1);
        frameTomorrow.style.display = '';
        frameTomorrow.src = anchorFor(tm);
      } else {
        frameTomorrow.style.display = 'none';
      }
      localStorage.setItem('sportsHomeDate', ymd);
    }

    // init
    const todayYMD = fmtDateYMD(new Date());
    const savedDate = localStorage.getItem('sportsHomeDate');
    const startDate = savedDate || todayYMD;
    datePick.value = startDate;
    setDate(startDate);

    // controls
    prevBtn.addEventListener('click', ()=> setDate(addDays(datePick.value, -1)));
    nextBtn.addEventListener('click', ()=> setDate(addDays(datePick.value, 1)));
    todayBtn.addEventListener('click', ()=> setDate(fmtDateYMD(new Date())));
    datePick.addEventListener('change', ()=> setDate(datePick.value));
    tomorrowToggle.addEventListener('change', ()=> setDate(datePick.value));

    openSrc.addEventListener('click', ()=> window.open('https://sport.virgilio.it/guida-tv/', '_blank', 'noopener'));
    openStandalone.addEventListener('click', ()=> window.open(BASE, '_blank', 'noopener'));
  </script>
</body>
</html>